<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>GAM - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GAM" />
<meta property="og:description" content="Hoy he dado una charla en la Carlos III. En la comida me han preguntado, algo extrañados, por un ejemplo que había enseñado en el que ajustaba un modelo usando GAMs.
El motivo era que quienes preguntaban —que trabajan con ese tipo de modelos— encuentran muy difícil, se ve, convencer a otros usuarios de los métodos estadísticos (economistas, etc.) de adoptarlos. Yo he contestado que hace unos pocos días a unos primíparos que acababan de ajustar sus tres primeros lms con R les invité a probar GAMs con sus datos." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2015/11/13/gam/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-11-13T08:13:53&#43;00:00" />
<meta property="article:modified_time" content="2015-11-13T08:13:53&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GAM</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2015-11-13T08:13:53Z">2015-11-13</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/estad%C3%ADstica/" rel="category">estadística</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Hoy he dado <a href="http://www.datanalytics.com/2015/11/09/requisitos-para-mi-taller-en-el-i-international-workshop-on-advances-in-functional-data-analysis/">una charla en la Carlos III</a>. En la comida me han preguntado, algo extrañados, por un ejemplo que había enseñado en el que ajustaba un modelo usando <a href="http://www3.nd.edu/~mclark19/learn/GAMS.pdf">GAMs</a>.</p>
<p>El motivo era que quienes preguntaban —que trabajan con ese tipo de modelos— encuentran muy difícil, se ve, convencer a otros usuarios de los métodos estadísticos (economistas, etc.) de adoptarlos. Yo he contestado que hace unos pocos días a unos <a href="http://dirae.es/palabras/prim%C3%ADpara">primíparos</a> que acababan de ajustar sus tres primeros <code>lms</code> con R les invité a probar GAMs con sus datos. ¿Por qué no?</p>
<p>La situación que teníamos planteada era parecida aunque un poco más complicada que esta:</p>
<pre><code>irradiation &lt;- read.table(&quot;http://rredc.nrel.gov/solar/old_data/nsrdb/1961-1990/hourly/1990/13994_90.txt&quot;,
                          header = F, skip = 1)

irradiation &lt;- irradiation[,4:5]
names(irradiation) &lt;- c(&quot;hour&quot;, &quot;irradiation&quot;)

plot(irradiation$hour, irradiation$irradiation, xlab = &quot;hora&quot;, ylab = &quot;irradiación&quot;)
</code></pre>
<p>que produce</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion00.png"><img src="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion00.png" alt="irradiacion00">
</a></p>
<p>Obviamente, la irradiación solar (en San Luis, Misuri, durante el año 1990) depende grandemente de la hora del día.</p>
<p>Si uno prueba lo de siempre, lo que enseñan al principio, lo que parece que solo le está permitido a uno si no consigue cinturón negro en las artes del chamanismo estadístico, obtiene</p>
<pre><code>mi.lm &lt;- lm(irradiation ~ hour, data = irradiation)

summary(mi.lm)

# Call:
#   lm(formula = irradiation ~ hour, data = irradiation)
#
# Residuals:
#   Min     1Q Median     3Q    Max
# -341.2 -336.9 -260.4  336.0  930.4
#
# Coefficients:
#   Estimate Std. Error t value Pr(&gt;|t|)
# (Intercept) 335.4736     9.1814  36.538   &lt;2e-16 ***
#   hour          0.2408     0.6426   0.375    0.708
# ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
# Residual standard error: 416.3 on 8758 degrees of freedom
# Multiple R-squared:  1.604e-05,	Adjusted R-squared:  -9.814e-05
# F-statistic: 0.1405 on 1 and 8758 DF,  p-value: 0.7078

plot(irradiation$hour, irradiation$irradiation, xlab = &quot;hora&quot;, ylab = &quot;irradiación&quot;)
abline(mi.lm, col = &quot;red&quot;)
</code></pre>
<p>El gráfico obtenido, que muestra la predicción del modelo en rojo es</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion01.png"><img src="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion01.png" alt="irradiacion01">
</a></p>
<p>En resumen, la hora del día, aunque manifiestamente relacionada con la predicción, tiene un coeficiente nulo según los manuales al uso y quedaría fuera del estudio según los más de ellos. ¡Fijaos en ese p-valor tan tirrioso!</p>
<p>Contraintiutivo, ¿verdad?</p>
<p>¿Por qué no probar entonces con un modelo que recoja el efecto no lineal de la hora? En el menú tampoco hay tantas opciones y con suerte uno desemboca muy naturalmente en</p>
<pre><code>library(&lt;a href=&quot;http://inside-r.org/r-doc/mgcv/mgcv&quot;&gt;mgcv)

mi.gam &lt;- &lt;a href=&quot;http://inside-r.org/r-doc/mgcv/gam&quot;&gt;gam(irradiation ~ &lt;a href=&quot;http://inside-r.org/r-doc/mgcv/s&quot;&gt;s(hour, &lt;a href=&quot;http://inside-r.org/r-doc/splines/bs&quot;&gt;bs = &quot;cr&quot;), data = irradiation)

summary(mi.gam)

# Family: gaussian
# Link function: identity
#
# Formula:
#   irradiation ~ s(hour, bs = &quot;cr&quot;)
#
# Parametric coefficients:
#   Estimate Std. Error t value Pr(&gt;|t|)
# (Intercept)  338.484      1.647   205.5   &lt;2e-16 ***
#   ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
# Approximate significance of smooth terms:
#   edf Ref.df    F p-value
# s(hour) 8.919  8.998 6122  &lt;2e-16 ***
#   ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
# R-sq.(adj) =  0.863   Deviance explained = 86.3%
# GCV =  23799  Scale est. = 23772     n = 8760

plot(mi.gam, xlab = &quot;hora&quot;, ylab = &quot;irradiación&quot;)
</code></pre>
<p>que, ahora sí, produce</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion02.png"><img src="http://www.datanalytics.com/wp-uploads/2015/11/irradiacion02.png" alt="irradiacion02">
</a></p>
<p>El resto de la discusión es poco relevante para los que tenemos prisa.</p>
<p>Y las notas:</p>
<pre><code>  * Sí, podemos en este caso usar la hora como variable categórica (¿pero qué si tenemos minutos, etc.?)
  * Efectivamente, hay otras opciones en el menú. ¡Pero nos gusta la A de GAM!
  * Quienes no descabalgan de los `(g)lms` puede que igual se dediquen a analizar datos demasiado tontos; o puede que igual no sepan lo que hacen... ¡pobrecicos!
  * Quienes se quejan de que los del punto anterior no descabalgan tal vez no hayan sabido dar con el conjunto de datos —les regalo el de hoy— para convencerlos.
</code></pre>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/estad%C3%ADstica/" rel="tag">estadística</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/gam/" rel="tag">gam</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/mgcv/" rel="tag">mgcv</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">r</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2015/11/12/encuestas-censos-elecciones/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">Encuestas, censos, elecciones</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2015/11/16/lo-poco-y-lo-mucho-lo-malo-lo-regular-y-lo-bueno/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">Lo poco y lo mucho; lo malo, lo regular y lo bueno</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>