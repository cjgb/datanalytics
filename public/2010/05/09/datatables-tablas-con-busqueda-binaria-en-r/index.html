<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Datatables: tablas con búsqueda binaria en R - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Datatables: tablas con búsqueda binaria en R" />
<meta property="og:description" content="No hace mucho me enfrenté con un problema en el trabajo. Quería cruzar dos tablas, una de algunos miles de millones de registros y otra de algunos cientos de miles para, simplemente, contar el número de filas finales que aparecían por fecha.
Cada una de las tablas tenía algunos filtros y agregaciones; el cruce final se realizaba sobre las subconsultas resultantes. El gestor de bases de datos que utilizamos, Teradata (sin comentarios), no podía con el cruce: las decisiones que tomaba internamente el presunto optimizador de consultas conducían inexorablemente a un error de espacio." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2010/05/09/datatables-tablas-con-busqueda-binaria-en-r/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-05-09T15:28:47&#43;00:00" />
<meta property="article:modified_time" content="2010-05-09T15:28:47&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Datatables: tablas con búsqueda binaria en R</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2010-05-09T15:28:47Z">2010-5-9</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/r/" rel="category">r</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>No hace mucho me enfrenté con un problema en el trabajo. Quería cruzar dos tablas, una de algunos miles de millones de registros y otra de algunos cientos de miles para, simplemente, contar el número de filas finales que aparecían por fecha.</p>
<p>Cada una de las tablas tenía algunos filtros y agregaciones; el cruce final se realizaba sobre las subconsultas resultantes. El gestor de bases de datos que utilizamos, Teradata (sin comentarios), no podía con el cruce: las decisiones que tomaba internamente el presunto optimizador de consultas conducían inexorablemente a un error de espacio.</p>
<p>Decidí comprobar si esta tarea que una instalación de Teradata de varios millones de euros de precio era incapaz de realizar podía llevarse a cabo en mi pequeño ordenador con el <em>software</em> adecuado. Así que realicé las dos subconsultas independientemente, volqué los resultados a sendos ficheros de texto (de 5 y 367MB respectivamente, que corresponden a 150k y 12M de filas) y los cargué en R.</p>
<p>Tras algunas modificaciones en los datos (cambios de tipos y nombres de las columnas, etc.) obtuve dos <em>dataframes</em>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">&gt; <span style="color:#a6e22e">head</span>(<span style="color:#a6e22e">epi</span>)
    <span style="color:#a6e22e">cta</span> <span style="color:#a6e22e">prtda</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">8301</span> <span style="color:#ae81ff">77920</span>
<span style="color:#ae81ff">2</span>  <span style="color:#ae81ff">476</span> <span style="color:#ae81ff">45526</span>
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">5350</span> <span style="color:#ae81ff">65100</span>
<span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">878</span> <span style="color:#ae81ff">46057</span>
<span style="color:#ae81ff">5</span> <span style="color:#ae81ff">6614</span> <span style="color:#ae81ff">80059</span>
<span style="color:#ae81ff">6</span> <span style="color:#ae81ff">8470</span> <span style="color:#ae81ff">78830</span>
</code></pre></td></tr></table>
</div>
</div>
<p>de 150.000 filas que asigna a cada cuenta, <code>cta</code>, una serie de partidas, <code>prtda</code>, y</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">&gt; <span style="color:#a6e22e">head</span>( <span style="color:#a6e22e">saldos</span> )
 <span style="color:#a6e22e">fec</span> <span style="color:#a6e22e">cta</span> <span style="color:#a6e22e">ofi</span>
[<span style="color:#ae81ff">1</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">40</span>
[<span style="color:#ae81ff">2</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">70</span>
[<span style="color:#ae81ff">3</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>   <span style="color:#ae81ff">1</span>
[<span style="color:#ae81ff">4</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">11</span>
[<span style="color:#ae81ff">5</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">21</span>
[<span style="color:#ae81ff">6</span>,]   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">31</span>
</code></pre></td></tr></table>
</div>
</div>
<p>de 12 millones de filas que para cada fecha, fec, y oficina, ofi, lista los correspondientes tipos de cuenta, cta, existentes.</p>
<p>Estas tablas cruzan por el campo cta, cuenta. A cada cuenta le corresponde una partida y el objetivo final era saber para cada fecha (fec), cuántas combinaciones de oficina (ofi) y partida existían. Un <code>merge</code> directo requería más memoria de la disponible, así que fabriqué el cruce a mano mediante el siguiente código:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">foo</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>( <span style="color:#a6e22e">prtda</span> ){
    <span style="color:#a6e22e">tmp</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">cta</span>[ <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">prtda</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">prtda</span> ]
    <span style="color:#a6e22e">unique</span>(<span style="color:#a6e22e">subset</span>(<span style="color:#a6e22e">saldos</span>, <span style="color:#a6e22e">cta</span> <span style="color:#f92672">%</span><span style="color:#a6e22e">in</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">tmp</span>, <span style="color:#66d9ef">select</span> = <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">fec</span>, <span style="color:#a6e22e">ofi</span>)))
}

<span style="color:#a6e22e">tmp</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>(<span style="color:#a6e22e">unique</span>(<span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">prtda</span>), <span style="color:#a6e22e">foo</span>, <span style="color:#a6e22e">simplify</span> = <span style="color:#a6e22e">F</span>)
<span style="color:#a6e22e">table</span>(<span style="color:#a6e22e">do</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">rbind</span>, <span style="color:#a6e22e">tmp</span>)<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">fec</span>)
</code></pre></td></tr></table>
</div>
</div>
<p>El código aplica a cada partida la función foo que hace lo siguiente:</p>
<ol>
<li>Selecciona las cuentas que la tienen asociada en la tabla epi.</li>
<li>Devuelve una subtabla de saldos que contiene las fechas y oficinas en las que existe esa cuenta.</li>
</ol>
<p>Finalmente, estas subtablas se apilan y la función table cuenta el número de filas por fecha.</p>
<p>Aunque tal vez no sea la manera más rápida de hacerlo, se trata de la implementación manual del método de los <em>bucles anidados</em> para realizar cruces de tablas. Que es, de hecho, el más robusto (en el sentido de que utiliza la mínima cantidad posible de memoria) y, aunque no siempre sea el óptimo, no suele estar nunca muy alejado de él. <a href="http://oreilly.com/catalog/9780596005733">Eso dice,al menos, la teoría</a>.</p>
<p>Para implementar correctamente el algoritmo de los bucles anidados uno debe recorrer la tabla más pequeña y buscar las coincidentes, una a una, en la más grande. Y para que el proceso no se eternice, el acceso a esta última debe realizarse a través de un índice.</p>
<p>En R no hay índices y, de hecho, casi todo el tiempo de ejecución se consume en</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">subset</span>(<span style="color:#a6e22e">saldos</span>, <span style="color:#a6e22e">cta</span> <span style="color:#f92672">%</span><span style="color:#a6e22e">in</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">tmp</span>, <span style="color:#66d9ef">select</span> = <span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">2</span>)
</code></pre></td></tr></table>
</div>
</div>
<p>Recordemos que saldos tiene 12 millones de líneas y ese comando implica:</p>
<ol>
<li>Ver cuáles de las cuentas de un vector de longitud 12 millones están contenidas en el vector tmp (de longitud media 15).</li>
<li>Seleccionar dichas filas de una tabla de longitud 12 millones.</li>
</ol>
<p>Aunque esas operaciones son muy rápidas para tablas pequeñas (para las que R fue concebido originalmente, téngase presente), 12 millones es un número lo suficientemente elevado como para que O(n) —el tiempo que consume una búsqueda lineal, que es la que hace subset en un data.frame— sea significativamente superior a O(log n) —el de una búsqueda binaria.</p>
<p>Pero el paquete data.table enriquece R con una nueva estructura de datos, las data.tables, que vienen a ser data.frames indexados. Usando dicho paquete, se puede hacer</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">saldos</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">table</span>( <span style="color:#a6e22e">saldos</span> )
<span style="color:#a6e22e">setkey</span>( <span style="color:#a6e22e">saldos</span>, <span style="color:#a6e22e">cta</span> )
<span style="color:#a6e22e">foo</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>( <span style="color:#a6e22e">prtda</span> ){
     <span style="color:#a6e22e">tmp</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">cta</span>[ <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">prtda</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">prtda</span> ]
   <span style="color:#a6e22e">unique</span>( <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">frame</span>( <span style="color:#a6e22e">saldos</span>[ <span style="color:#a6e22e">J</span>(<span style="color:#a6e22e">tmp</span>), <span style="color:#a6e22e">j</span> = <span style="color:#a6e22e">c</span>( <span style="color:#e6db74">&#34;fec&#34;</span>, <span style="color:#e6db74">&#34;ofi&#34;</span> ),
        <span style="color:#a6e22e">mult</span> = <span style="color:#e6db74">&#34;all&#34;</span>, <span style="color:#a6e22e">with</span> = <span style="color:#a6e22e">FALSE</span> ] ) )
}
</code></pre></td></tr></table>
</div>
</div>
<p>La primera línea transforma saldos de un data.frame en un data.table. La segunda, lo indexa por la columna cta. La única diferencia en la función es que para filtrar por tmp se utiliza la expresión</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">saldos</span>[ <span style="color:#a6e22e">J</span>(<span style="color:#a6e22e">tmp</span>), <span style="color:#a6e22e">j</span> = <span style="color:#a6e22e">c</span>( <span style="color:#e6db74">&#34;fec&#34;</span>, <span style="color:#e6db74">&#34;ofi&#34;</span> ), <span style="color:#a6e22e">mult</span> = <span style="color:#e6db74">&#34;all&#34;</span>, <span style="color:#a6e22e">with</span> = <span style="color:#a6e22e">FALSE</span> ]
</code></pre></td></tr></table>
</div>
</div>
<p>que busca en saldos utilizando el índice sobre cta. El porqué de esta sintaxis, tal vez poco intuitiva, puede consultarse en las ayudas del paquete.</p>
<p>Los tiempos de ejecución para la primera alternativa son de</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">&gt; <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">time</span>( <span style="color:#a6e22e">kk</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>( <span style="color:#a6e22e">unique</span>( <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">prtda</span> ), <span style="color:#a6e22e">foo</span>, <span style="color:#a6e22e">simplify</span> = <span style="color:#a6e22e">F</span> ) )
 <span style="color:#a6e22e">user</span>  <span style="color:#a6e22e">system</span> <span style="color:#a6e22e">elapsed</span>
<span style="color:#ae81ff">5566.15</span>  <span style="color:#ae81ff">873.94</span> <span style="color:#ae81ff">7088.15</span>
</code></pre></td></tr></table>
</div>
</div>
<p>mientras que para la segunda quedan en:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">&gt; <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">time</span>( <span style="color:#a6e22e">tmp</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>( <span style="color:#a6e22e">unique</span>( <span style="color:#a6e22e">epi</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">prtda</span> ), <span style="color:#a6e22e">foo</span>, <span style="color:#a6e22e">simplify</span> = <span style="color:#a6e22e">F</span> ) )
 <span style="color:#a6e22e">user</span>  <span style="color:#a6e22e">system</span> <span style="color:#a6e22e">elapsed</span>
    <span style="color:#ae81ff">994.96</span>   <span style="color:#ae81ff">18.63</span> <span style="color:#ae81ff">1776.70</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Aunque los tiempos reales (<em>elapsed</em>) son muy elevados hay que tener en cuenta que, en mi prueba, están exagerados por las circuntancias de la ejecución: simultáneamente en una misma máquina, con restricciones de memoria y, por lo tanto, algo de paginación. En cualquier caso, lo verdaderamente relevante son los ratios entre ambos procedimientos, muy favorables para las data.tables con respecto a los data.frames originales.</p>
<p>En resumen, gracias al trabajo de Matthew Dowle, <a href="http://cran.r-project.org/web/packages/data.table/index.html">disponemos de un nuevo paquete, data.table</a>, que va a conseguir que nuestro código en R vuele cuando tengamos que realizar búsquedas en tablas grandes.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">r</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/sql/" rel="tag">sql</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/paquetes/" rel="tag">paquetes</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/data.table/" rel="tag">data.table</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2010/05/07/hemos-salido-de-la-recesion-queremos-nuestros-intervalos-de-confianza/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">¿Hemos salido de la recesión? ¡Queremos nuestros intervalos de confianza!</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2010/05/10/hasta-microsoft/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">¡Hasta Microsoft!</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>