<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Una solución al problema de la separación perfecta con regresiones logísticas - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Una solución al problema de la separación perfecta con regresiones logísticas" />
<meta property="og:description" content="Cuando el otro día planteé al mis lectores el problema de cómo representar de manera efectiva un conjunto de datos pequeños, no lo hice de manera enteramente ociosa. Eran datos reales de un cliente que tropezó con el llamado problema de la separación perfecta al intentar aplicar una regresión logística.
Veamos de nuevo los datos:

En la gráfica cada punto representa un individuo (posiblemente una persona). Los grupos los distinguen en dos clases (posiblemente, enfermos y sanos)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2010/10/25/una-solucion-al-problema-de-la-separacion-perfecta-con-regresiones-logisticas/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-10-25T22:56:39&#43;00:00" />
<meta property="article:modified_time" content="2010-10-25T22:56:39&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Una solución al problema de la separación perfecta con regresiones logísticas</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2010-10-25T22:56:39Z">2010-10-25</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/estad%C3%ADstica/" rel="category">estadística</a>, <a class="meta__link" href="/categories/r/" rel="category">r</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Cuando el otro día planteé al mis lectores el problema de <a href="http://www.datanalytics.com/blog/2010/09/16/representando-graficamente-conjuntos-de-datos-pequenos/">cómo representar de manera efectiva un conjunto de datos pequeños</a>, no lo hice de manera enteramente ociosa. Eran datos reales de un cliente que tropezó con el llamado problema de la separación perfecta al intentar aplicar una regresión logística.</p>
<p>Veamos de nuevo los datos:</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2010/10/base_data.png"><img src="http://www.datanalytics.com/wp-uploads/2010/10/base_data.png" alt="">
</a></p>
<p>En la gráfica cada punto representa un individuo (posiblemente una persona). Los grupos los distinguen en dos clases (posiblemente, enfermos y sanos). La variable en el eje de la x mide el nivel de cierta proteína (supongo que en las células de algún tipo de tejido). Si se intenta realizar una regresión logística sobre este conjunto de datos sucede una catástrofe: el algoritmo diverge, aparecen mensajes de error en la pantalla, etc. ¡Es el problema de la separación perfecta!</p>
<p>Es fácil ver por qué ocurre. En los datos se aprecia cómo el nivel de proteína 9 separa los de los dos grupos. Por lo tanto, $latex x_i - 9$ es positivo o negativo según el grupo. De ahí que dado un valor $latex \beta &gt; 0$ lo suficientemente grande, la expresión</p>
<p>$$\beta ( x_i - 9 )$$</p>
<p>puede tomar valores positivos en un grupo y negativos en el otro de valor (absoluto) arbitrariamente elevado. Como en el modelo de regresión logística aproximamos la probabilidad de que un individuo $latex i$ pertenezca a uno de los grupos por (una expresión parecida a)</p>
<p>$$P(i) = \frac{1}{1+ \exp(\beta ( x_i - 9 ) )},$$</p>
<p>basta con tomar un valor del parámetro $latex \beta$ lo suficientemente grande para que dicha probabilidad sea todo lo próxima que se quiera a 1 para los individuos de uno de los grupos y 0 para los del otro. ¡La <em>solución</em> en este caso es $latex +\infty$!</p>
<p>Este problema puede observarse gráficamente en la siguiente animación (que es posible que no esté animada en todos los navegadores):<a href="http://www.datanalytics.com/wp-uploads/2010/10/logistic_regression_approximation.png"><img src="http://www.datanalytics.com/wp-uploads/2010/10/logistic_regression_approximation.png" alt="">
</a></p>
<p>Een general, la separación perfecta puede ocurrir sobre combinaciones de variables sin que suceda individualmente en ninguna de ellas: basta con que un hiperplano separe perfectamente las observaciones de las dos clases.</p>
<p>Sea como fuere, hay que encontrarle <em>solución</em> a este <em>problema</em> de la separación infinita. Hay que advertir primero que el problema de la separación perfecta <strong>no es un problema</strong>. Es, incluso, deseable. ¡Ojalá siempre nuestros datos fuesen tan conclusivos! (Esto queda dicho sin perjuicio de una regla prácticamente sin excepciones en algunos ámbitos —sobre todo de la investigación social—: si una variable es demasiado buena&hellip; seguramente está contaminada de alguna manera por la variable objetivo). He llegado a leer que de darse el problema de la separación perfecta, una posible solución pasa por eliminar la variable implicada. ¡Eliminar la variable más predictiva!</p>
<p>Entre las soluciones que tienen algún sentido, aquélla por la que me decanté cuando me enfrenté al encargo de mi cliente fue la de la regresión logística con la penalización de Firth. Lo hice por varios motivos:</p>
<ol>
<li>El más tonto de todos ellos es que <a href="http://www.meduniwien.ac.at/msi/biometrie/publikationen/Separata/Heinze_Schemper_2002_Statistics%20in%20Medicine.pdf">está publicado</a>. Ya estoy demasiado viejo como para sugerir cosas no publicadas: es una pérdida de tiempo y energía que, además, ni se paga ni se agradece.</li>
<li>Está <a href="http://cran.r-project.org/web/packages/logistf/">implementado en R</a>.</li>
<li>Tiene cierto sentido y es coherente con toda una corriente de pensamiento muy popular en la disciplina durante los últimos años: que es la de la penalización de los coeficientes (<em>ridge regression</em>, <em>lasso</em>, etc.).</li>
</ol>
<p>En esencia, la corrección de Firth es una penalización en el tamaño de los coeficientes: impide que ninguno de ellos crezca ilimitadamente. Pero se comprende mejor desde una óptica bayesiana.</p>
<p>Así, al realizar una regresión logística se busca maximizar la función de verosimilitud $latex L( \beta ) = \log f( x | \beta )$. La modificación de Firth busca el máximo (o moda) de la distribución <em>a posteriori</em> de $latex \beta$ tomando como distribución <em>a priori</em> una distribución no informativa: la llamada <a href="http://en.wikipedia.org/wiki/Jeffreys_prior">distribución de Jeffrey</a>. La distribución a_ posteriori_ de $latex \beta$ es, aplicando el teorema de Bayes, proporcional a</p>
<p>$$f( x | \beta ) J( \beta )$$</p>
<p>Y su logaritmo,</p>
<p>$$\log f( x | \beta ) + \log J( \beta ),$$</p>
<p>que es la función de verosimilitud asociada a la regresión logística habitual más un término que depende únicamente de $latex \beta$.</p>
<p>Basta con que $latex J( \beta )$ sea una función que decrezca lo suficientemente deprisa en su argumento como para que el máximo de la función resultante sea finito. La verdad, nadie sabe muy a las ciertas cómo es $latex J$ (algo de información hay <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2680313/">acá</a>) en este contexto pero parece que basta para garantizar la finitud.</p>
<p>Es necesario señalar cómo elecciones disitntas de la distribución <em>a priori</em> del parámetro $latex \beta$ (¿por qué no $latex N(0, \sigma)$?) puede dar lugar a resultados distintos dependiendo del grado de penalización que implique la distribución de partida. Asintóticamente, tanto da. Pero cuando n es pequeño, al final, p-valores, <em>odds ratios</em>, etc. dependen principalmente de la elección de distribución a priori que hizo el Sr. Firth en 1993.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/estad%C3%ADstica/" rel="tag">estadística</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">r</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2010/10/22/tutorial-instalacion-de-la-extension-de-r-para-rapidminer/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">Tutorial: instalación de la extensión de R para RapidMiner</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2010/10/26/a-vueltas-con-los-fractales/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">A vueltas con los fractales</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>