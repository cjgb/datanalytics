<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Modelos lineales mixtos para la optimización de queries - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Modelos lineales mixtos para la optimización de queries" />
<meta property="og:description" content="Hoy aprovecho que pasan dos pájaros por el cielo para pegar un tiro que, seguro, es del interés de mis lectores: voy a utilizar un modelo lineal mixto para estudiar los factores que afectan al rendimiento de una familia de queries de SQL complejas.
El objetivo final es contar con criterios empíricos para la optimización de ciertas queries (siento decir optimización de queries: me obliga a ello la voluntad de que los buscadores me indexen donde más búsquedas se vayan a realizar; por una vez, renegaré del talibán ortográfico que llevo dentro) e, indirectamente, ilustrar con datos distintos de los habituales esta técnica estadística." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2010/08/26/modelos-lineales-mixtos-para-la-optimizacion-de-queries/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-08-26T22:11:41&#43;00:00" />
<meta property="article:modified_time" content="2010-08-26T22:11:41&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Modelos lineales mixtos para la optimización de queries</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2010-08-26T22:11:41Z">2010-8-26</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/estad%C3%ADstica/" rel="category">estadística</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Hoy aprovecho que pasan dos pájaros por el cielo para pegar un tiro que, seguro, es del interés de mis lectores: voy a utilizar un modelo lineal mixto para estudiar los factores que afectan al rendimiento de una familia de <em>queries</em> de SQL complejas.</p>
<p>El objetivo final es contar con criterios empíricos para la optimización de ciertas <em>queries</em> (siento decir <em>optimización de queries</em>: me obliga a ello la voluntad de que los buscadores me indexen donde más búsquedas se vayan a realizar; por una vez, renegaré del talibán ortográfico que llevo dentro) e, indirectamente, ilustrar con datos distintos de los habituales esta técnica estadística.</p>
<p>La query tiene este aspecto:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> ( un carajal de tablas y subconsultas ) <span style="color:#66d9ef">where</span>
fecha <span style="color:#f92672">=</span> :fecha: <span style="color:#66d9ef">and</span>
unidad <span style="color:#f92672">=</span> :unidad: <span style="color:#66d9ef">and</span>
cuenta <span style="color:#f92672">=</span> :cuenta:
;</code></pre></td></tr></table>
</div>
</div>
<p>Los dos factores que se consideran potencialmente críticos para el rendimiento de la <em>query</em> son el número de filas correspondientes a una unidad dada (unit.size en lo sucesivo) en una de las tablas subyacentes y el número de filas correspondientes a una cuenta determinada en otra de dichas tablas (account.size).</p>
<p>Además, se observa que la carga de la base de datos varía mucho en función de factores externos (¿otros usuarios accediendo a ella?) fuera de nuestro control.</p>
<p>Por tanto, analizaremos los tiempos de ejecución de la <em>query</em> en función de unit.size, account.size y, finalmente, de los factores no controlados. Para ello, se selecionamos 200 <em>queries</em>, es decir, 200 combinaciones de unidad, cuenta y fecha. Cada una de las queries se ejecuta 5 veces.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
unidades <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>( unidades, n )
epigrafes <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>( epigrafes, n )
fechas <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>( fechas, n, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span> )</code></pre></td></tr></table>
</div>
</div>
<p>Además, se aleatoriza con respecto al tiempo. Esto se hace para evitar que el efecto de las fluctuaciones de carga del servidor se confundan con el efecto de las distintas <em>queries</em>. Distribuyendo aleatoriamente en el tiempo el momento de la ejecución de una misma <em>query</em> se reduce la posibilidad de que todas las iteraciones de una de ellas se realicen en periodos de carga anormalmente alta o baja (los puristas del diseño experimental nos aplaudirían en este punto sólo a medias).</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">n.rep <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">5</span>
iter.order <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>( <span style="color:#a6e22e">rep</span>( <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n, n.rep ) )</code></pre></td></tr></table>
</div>
</div>
<p>Finalmente, se construye el conjunto de datos mediante</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">salida <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>( rbind, <span style="color:#a6e22e">sapply</span>( iter.order, foo.sample, simplify <span style="color:#f92672">=</span> F ) )</code></pre></td></tr></table>
</div>
</div>
<p>donde <code>foo.sample</code> es la función que ejecuta la <em>query</em> contra la base de datos, cuenta el número de registros, etc.</p>
<p>Los datos resultantes pueden descargarse <a href="http://www.datanalytics.com/uploads/query_time_analysis.csv">aquí</a>. Se trata de una tabla con cuatro columnas: el identificador de la <em>query</em>, el tiempo de ejecución, unit.size y account.size. (Debería ser ocioso decir aquí que el identificador está asociado al enunciado de la <em>query</em> y no su ejecución puesto que cada una de ellas se repite 5 veces).</p>
<h2 id="análisis-estadístico">Análisis estadístico</h2>
<p>Descargamos y normalizamos en primer lugar los datos:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>( <span style="color:#a6e22e">url</span>(
    <span style="color:#e6db74">&#34;http://www.datanalytics.com/uploads/query_time_analysis.csv&#34;</span> ),
    header <span style="color:#f92672">=</span> T )

normalize <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>( x ) ( x <span style="color:#f92672">-</span> <span style="color:#a6e22e">mean</span>( x ) ) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sd</span>( x )

dat<span style="color:#f92672">$</span>unit.size <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">normalize</span>( dat<span style="color:#f92672">$</span>unit.size )
dat<span style="color:#f92672">$</span>account.size <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">normalize</span>( dat<span style="color:#f92672">$</span>account.size )
dat<span style="color:#f92672">$</span>id <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">factor</span>( dat<span style="color:#f92672">$</span>id )</code></pre></td></tr></table>
</div>
</div>
<p>(La normalización se hace especialmente para facilitar la interpretación del modelo que se plantea más abajo). A continuación, creamos un objeto de la clase <code>groupedData</code>,</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>( nlme )
dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">groupedData</span>( query.time <span style="color:#f92672">~</span> unit.size <span style="color:#f92672">+</span> account.size  <span style="color:#f92672">|</span> id, data <span style="color:#f92672">=</span> dat )</code></pre></td></tr></table>
</div>
</div>
<p>que viene a ser un data.frame con información sobre cómo ciertas filas están asociadas entre sí. De forma que si uno hace</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">plot</span>( <span style="color:#a6e22e">groupedData</span>( query.time <span style="color:#f92672">~</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id, data <span style="color:#f92672">=</span> dat ) )</code></pre></td></tr></table>
</div>
</div>
<p>se obtiene el siguiente gráfico:</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2010/08/grouped_data.png"><img src="http://www.datanalytics.com/wp-uploads/2010/08/grouped_data.png" alt="">
</a>Se aprecia en él cómo la varianza de los tiempos de ejecución crece con éstos. Además, por consideraciones relativas a la construcción de los datos —un cruce de varias tablas de cada una de las cuales se extrae un número variable de filas— hay razones para intuir una estructura multiplicativa en los datos. Eso nos hace considerar el uso de logaritmos. De hecho,</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">plot</span>( <span style="color:#a6e22e">groupedData</span>( <span style="color:#a6e22e">log</span>(query.time) <span style="color:#f92672">~</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id, data <span style="color:#f92672">=</span> dat ) )</code></pre></td></tr></table>
</div>
</div>
<p>que produce la gráfica</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2010/08/grouped_log_data.png"><img src="http://www.datanalytics.com/wp-uploads/2010/08/grouped_log_data.png" alt="">
</a></p>
<p>que tiene mejor aspecto. No es todo lo bueno que uno quisiera, pero tiene mejor aspecto. Nótese además, cómo el que los datos aparezcan ordenados en la figura puede hacer sobreestimar el efecto de la dispersión de la varianza. En realidad, más adelante, se plantea como ejercicio verificar de una manera más canónica cómo el tomar logaritmos no deja de tener sentido.</p>
<p>Finalmente, planteamos el modelo mixto usando la función lme del paquete nlme:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    modelo <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lme</span>( <span style="color:#a6e22e">log2</span>( query.time ) <span style="color:#f92672">~</span> unit.size <span style="color:#f92672">+</span> account.size,
       random <span style="color:#f92672">=</span> <span style="color:#f92672">~</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> id , data <span style="color:#f92672">=</span> dat )</code></pre></td></tr></table>
</div>
</div>
<p>El modelo consta términos fijos (<code>unit.size</code> y <code>account.size</code>) y de una parte aleatoria, <code>~1 | id</code>. La parte aleatoria, de acuerdo con el consejo recurrente de mi colega Olivier Núñez en <a href="https://stat.ethz.ch/mailman/listinfo/r-help-es">r-help-es</a>, comprende aquellos términos del modelo que variarían de realizarse de nuevo el experimento. Y, efectivamente, la próxima vez que se ejecute una <em>query</em>, es improbable que ésta sea una de las 200 seleccionadas más arriba. El enunciado particular de la <em>query</em> es, por lo tanto, variable (o aleatorio, en nuestro contexto).</p>
<p>Alternativamente, usando modelos no mixtos, podría plantearse el modelo <em>equivalente</em></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">modelo.lm <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lm</span>( <span style="color:#a6e22e">log2</span>( query.time ) <span style="color:#f92672">~</span>
    id <span style="color:#f92672">+</span> unit.size <span style="color:#f92672">+</span> account.size, data <span style="color:#f92672">=</span> dat )</code></pre></td></tr></table>
</div>
</div>
<p>que haría aparecer 200 (técnicamente, 199 porque no se ha eliminado el término independiente del modelo) coeficientes nuevos que representarían la variación en los tiempos de ejecución atribuida a cada enunciado de query en particular (variación que puede deberse a la distinta distribución de la filas correspondientes a distintas unidades o cuentas en el disco, etc.). Obviamente, estos coeficientes no son de mayor interés en sí mismos. A lo más, interesa saber si existen variaciones sustanciales entre las distintas queries que pudieran ser indicativas de algún fenómenono tenido en cuenta.</p>
<p>Mediante</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">summary</span>( modelo )</code></pre></td></tr></table>
</div>
</div>
<p>se obtiene:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">Linear mixed<span style="color:#f92672">-</span>effects model fit by REML
Data<span style="color:#f92672">:</span> dat
AIC    BIC  logLik
<span style="color:#ae81ff">3259.9</span> <span style="color:#ae81ff">3284.4</span> <span style="color:#ae81ff">-1625.0</span>

Random effects<span style="color:#f92672">:</span>
Formula<span style="color:#f92672">:</span> <span style="color:#f92672">~</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">id
</span><span style="color:#a6e22e"></span>(Intercept) Residual
StdDev<span style="color:#f92672">:</span>  <span style="color:#ae81ff">0.00029632</span>   <span style="color:#ae81ff">1.2220</span>

Fixed effects<span style="color:#f92672">:</span> <span style="color:#a6e22e">log2</span>(query.time) <span style="color:#f92672">~</span> unit.size <span style="color:#f92672">+</span> account.size
Value Std.Error  DF t<span style="color:#f92672">-</span>value p<span style="color:#f92672">-</span><span style="color:#a6e22e">value
</span><span style="color:#a6e22e"></span>(Intercept)  <span style="color:#ae81ff">0.70249</span>  <span style="color:#ae81ff">0.038644</span> <span style="color:#ae81ff">800</span> <span style="color:#ae81ff">18.1785</span>  <span style="color:#ae81ff">0.0000</span>
unit.size    <span style="color:#ae81ff">0.19907</span>  <span style="color:#ae81ff">0.038665</span> <span style="color:#ae81ff">197</span>  <span style="color:#ae81ff">5.1486</span>  <span style="color:#ae81ff">0.0000</span>
account.size <span style="color:#ae81ff">0.11006</span>  <span style="color:#ae81ff">0.038665</span> <span style="color:#ae81ff">197</span>  <span style="color:#ae81ff">2.8465</span>  <span style="color:#ae81ff">0.0049</span>
Correlation<span style="color:#f92672">:</span>
(Intr) unt.sz
unit.size    <span style="color:#ae81ff">0.000</span>
account.size <span style="color:#ae81ff">0.000</span>  <span style="color:#ae81ff">0.008</span>

Standardized Within<span style="color:#f92672">-</span>Group Residuals<span style="color:#f92672">:</span>
Min       Q1      Med       Q3      Max
<span style="color:#ae81ff">-1.82818</span> <span style="color:#ae81ff">-0.82791</span> <span style="color:#ae81ff">-0.23734</span>  <span style="color:#ae81ff">0.70098</span>  <span style="color:#ae81ff">3.63443</span>

Number of Observations<span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span>
Number of Groups<span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span></code></pre></td></tr></table>
</div>
</div>
<p>De la salida anterior interesan varios valores:</p>
<ul>
<li>En la sección correspondiente a los efectos aleatorios, la desviación estándar del término independiente, 0.00029632, que parece indicar que apenas hay variación entre las distintas <em>queries</em>.</li>
<li>En la misma sección, el valor relativamente elevado, 1.2220, del residuo. Eso indica que existe una variación importante entre ejecuciones distintas de la misma <em>query</em> debidas, probablemente, a las distintas condiciones de carga del servidor en el momento de la ejecución. ¡Muy sintomático!</li>
<li>En la sección de los términos fijos, el término independiente, de valor 0.7 y altamente significativo, debido a la peculiar normalización de los datos, indicaba un tiempo medio de ejecución de 2^0.7 = 1.62 segundos.</li>
<li>En dicha sección los coeficientes de unit.size y de account.size, también altamente significativos, auguraban un rendimiento desigual de las consultas, posiblemente inaceptablemente desigual.</li>
</ul>
<p>Finalmente, puede verse un gráfico de diagnóstico del modelo haciendo</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">plot</span>( modelo )</code></pre></td></tr></table>
</div>
</div>
<p>que produce</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2010/08/residuos.png"><img src="http://www.datanalytics.com/wp-uploads/2010/08/residuos.png" alt="">
</a></p>
<p>y que muestra cómo la varianza de los residuos no parece variar apreciablemente con el tamaño predicho del tiempo de ejecución.</p>
<h2 id="colofón">Colofón</h2>
<p>En primer lugar, quiero dejar planteados varios ejercicios que serán sin duda de sumo provecho para los más inquietos e interesados de mis lectores:</p>
<ul>
<li>Generar y analizar el gráfico de diagnóstico para el modelo análogo en el que no se toman logaritmos de la variable objetivo.</li>
<li>Calcular la varianza de los coeficientes asociados a cada una de las <em>queries</em> del modelo no mixto modelo.lm y compararla con la del término independiente de la parte aleatoria del modelo mixto.</li>
<li>Reconstruir el modelo sin normalizar las variables previamente y analizar (comparativamente) los resultados.</li>
</ul>
<p>Finalmente, doy respuesta a lo que más de uno se estará preguntando: todo esto, ¿para qué? Puede parecer, y alguno así me lo ha manifestado, un ejercicio ocioso. Pero, la verdad, los números muestran varios indicios fundamentales:</p>
<ul>
<li>El primero, que parece necesario identificar ventanas temporales en las que el servidor esté desocupado para realizar pruebas de rendimiento: dos desviaciones estándar de <em>ruido intra-query</em> multiplican los tiempos de ejecución en un factor de 5.4264 (=2^(2*1.22) ). Es algo que se intuía pero no se cuantificaba. Y que ponía en entredicho pruebas de rendimiento realizadas anteriormente.</li>
<li>El segundo, que las dependencias del tiempo de ejecución con respecto al tamaño de las <em>subqueries</em> no son, como se suponía un tanto cándidamente, O(1). Más bien, son O(n*m). Y esto sugirió <a href="http://www.datanalytics.com/blog/2010/05/19/%C2%BFen-que-se-parecen-oracle-y-teradata-a-excel-y-word/">alterar el orden de los cruces de las tablas</a> para lograr un plan de ejecución alternativo más rápido y robusto (que, de hecho, se encontró).</li>
</ul>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/estad%C3%ADstica/" rel="tag">estadística</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/modelos-mixtos/" rel="tag">modelos mixtos</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/sql/" rel="tag">sql</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2010/08/24/cinco-consejos-que-nunca-leera-quien-debe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">Cinco consejos que nunca leerá quien debe</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2010/08/27/cuanto-cuesta-una-licencia-de-sas/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">¿Cuánto cuesta una licencia de SAS?</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>