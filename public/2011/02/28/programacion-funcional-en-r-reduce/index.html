<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Programación funcional en R: Reduce - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Programación funcional en R: Reduce" />
<meta property="og:description" content="Siguiendo con la serie de artículos sobre programación funcional que comencé hablando de Filter() hace un tiempo, trataré hoy la función Reduce(). El contenido de cuanto sigue debería ser familiar de quienes asistieron al Taller Avanzado de R en las II Jornadas de Usuarios de R.
Reduce es el segundo de los tiempos de una abstracción popularizado por Google y otros pero que tiene sus raíces en los lenguajes funcionales (Lisp y otros): map-reduce." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2011/02/28/programacion-funcional-en-r-reduce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-02-28T09:07:36&#43;00:00" />
<meta property="article:modified_time" content="2011-02-28T09:07:36&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Programación funcional en R: Reduce</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2011-02-28T09:07:36Z">2011-2-28</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/r/" rel="category">r</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Siguiendo con la serie de artículos sobre programación funcional que comencé <a href="http://www.datanalytics.com/blog/2010/11/24/programacion-funcional-en-r-filter/">hablando de Filter()</a> hace un tiempo, trataré hoy la función Reduce(). El contenido de cuanto sigue debería ser familiar de quienes asistieron al Taller Avanzado de R en las <a href="http://www.datanalytics.com/blog/2010/12/29/noticia-de-las-ii-jornadas-de-usuarios-de-r/">II Jornadas de Usuarios de R</a>.</p>
<p>Reduce es el segundo de los tiempos de una abstracción popularizado por Google y otros pero que tiene sus raíces en los lenguajes funcionales (Lisp y otros): <em>map-reduce</em>. En resumen, <em>map</em> es la transformación</p>
<p>$$(v_1, \dots, v_n) \longmapsto (f(v_1), \dots, f(v_n))$$</p>
<p>mientras que reduce consiste en (algo parecido a)</p>
<p>$$(f(v_1), \dots, f(v_n))  \longmapsto F(f(v_1), \dots, f(v_n)),$$</p>
<p>que devuelve un único valor a partir del vector transformado. Dado un vector $latex v=(v_1, \dots, v_n)$ y una función $latex f$, sabemos cómo construir $latex (f(), \dots, f())$ y $latex (f(v_1), \dots, f(v_n))$ usando las funciones replicate() y sapply(). Lo que permite Reduce() es hacer</p>
<p>$$f(f(\dots f(f(v_1, v_2), v_3), \dots), v_n)$$</p>
<p>y, como consecuencia,</p>
<p>$$f(f(\dots f(x) \dots)).$$</p>
<p>En particular, Reduce() acepta como argumento una función (que, a su vez, acepta dos argumentos) y un vector (además de, posiblemente, argumentos auxiliares adicionales que el interesado encontrará en la ayuda).</p>
<p>El primer ejemplo es simple: vectorizar una función. Tambén es impráctico porque la función que queremos vectorizar ya está vectorizada: max().</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, y) <span style="color:#a6e22e">ifelse</span>(x <span style="color:#f92672">&gt;</span> y, x, y)     <span style="color:#75715e"># máximo de dos valores</span>
    v <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>)
    <span style="color:#a6e22e">Reduce</span>(f, v)
    <span style="color:#a6e22e">max</span>(v)</code></pre></td></tr></table>
</div>
</div>
<p>El segundo tiene que ver con <a href="http://es.wikipedia.org/wiki/Fracci%C3%B3n_continua">fracciones continuas</a>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, y) y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> x
    v <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>)
    <span style="color:#a6e22e">Reduce</span>(f, v, accumulate <span style="color:#f92672">=</span> T)</code></pre></td></tr></table>
</div>
</div>
<p>El interesado puede también probar a definir</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    <span style="color:#a6e22e">f</span>(x, y) <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> y</code></pre></td></tr></table>
</div>
</div>
<p>y jugar con las opciones right = T/F de Reduce().</p>
<p>El tercer ejemplo puede resultar más interesante. Hay algo de markoviano en la función Reduce() que hace que pueda aplicarse con (discutible, pues es una aproximación) éxito a la simulación de colas. En este caso, simulamos una cola en la que tanto el número de clientes que llegan como el de los que salen en cada intervalo de tiempo (pequeño y fijo) sigue una ley de Poisson. Esto es una aproximación de la situación tal vez más realista en la que ambos fenómenos se rigen por un proceso de Poisson (<a href="https://stat.ethz.ch/pipermail/r-help-es/2010-April/000891.html">que puede simularse tal como nos enseña Olivier Núñez en la lista de ayuda de R</a>).</p>
<p>El código es así:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10000</span>      <span style="color:#75715e"># n periodos de 1 minuto</span>
    lambda1 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">.3</span>   <span style="color:#75715e"># intensidad de las llegadas</span>
    lambda2 <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">.4</span>   <span style="color:#75715e"># intensidad del tiempo de servicio</span>

    events <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(
        entrada <span style="color:#f92672">=</span> <span style="color:#a6e22e">rpois</span>(n, lambda1),
        salida  <span style="color:#f92672">=</span> <span style="color:#a6e22e">rpois</span>(n, lambda2)
       )

    <span style="color:#75715e"># Convertimos el df en una lista por minutos</span>
    events <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">by</span>(events, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n, I)
    calcular.longitud.cola <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(long.cola, delta){
        <span style="color:#a6e22e">max</span>(<span style="color:#ae81ff">0</span>, long.cola <span style="color:#f92672">+</span> delta<span style="color:#f92672">$</span>entrada <span style="color:#f92672">-</span> delta<span style="color:#f92672">$</span>salida)
    }

    <span style="color:#75715e"># hour.events &lt;- Reduce(estado.cola, events, init = 0)</span>
    longitud.cola <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Reduce</span>(calcular.longitud.cola, events, init <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, accumulate <span style="color:#f92672">=</span> T)
    <span style="color:#a6e22e">plot</span>(longitud.cola, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;l&#34;</span>)</code></pre></td></tr></table>
</div>
</div>
<p>El interesado en profundizar en el estudio de esta función puede ejercitarse con los siguientes ejercicios:</p>
<ol>
<li>Vectorizar las funciones <code>cbind()</code> y <code>rbind()</code></li>
<li>Reescribir el código para reescribir el código que ofrecí en la entrada <a href="http://www.datanalytics.com/blog/2010/10/26/a-vueltas-con-los-fractales/">A vueltas con los fractales</a> usando la función <code>Reduce()</code></li>
</ol>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">r</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/programaci%C3%B3n-funcional/" rel="tag">programación funcional</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2011/02/25/1605/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">Hay vida feliz más allá del PIB</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2011/03/01/rstudio-un-nuevo-editor-multiplataforma-para-r/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">RStudio, un nuevo editor multiplataforma para R</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>