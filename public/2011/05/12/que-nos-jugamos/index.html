<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>¿Qué nos jugamos? - datanalytics</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="¿Qué nos jugamos?" />
<meta property="og:description" content="Imagine que le proponen participar reiteradamente en un juego de azar. Dispone de una cantidad de dinero inicial, $latex a$ euros, y puede apostar en un juego en el que o gana con probabilidad $latex p$ $latex b$ veces la apuesta o la pierde enteramente. Puede repetir el juego cuantas veces quiera y apostar el porcentaje que desee de su dinero.
¿Cuánto se apostaría? ¿Qué porcentaje de su capital inicial se jugaría?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2011/05/12/que-nos-jugamos/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-05-12T07:18:12&#43;00:00" />
<meta property="article:modified_time" content="2011-05-12T07:18:12&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="datanalytics" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">datanalytics</div>
					<div class="logo__tagline">Estadística y análisis de datos</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">¿Qué nos jugamos?</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2011-05-12T07:18:12Z">2011-5-12</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/probabilidad/" rel="category">probabilidad</a>, <a class="meta__link" href="/categories/r/" rel="category">r</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Imagine que le proponen participar reiteradamente en un juego de azar. Dispone de una cantidad de dinero inicial, $latex a$ euros, y puede apostar en un juego en el que o gana con probabilidad $latex p$ $latex b$ veces la apuesta o la pierde enteramente. Puede repetir el juego cuantas veces quiera  y apostar el porcentaje que desee de su dinero.</p>
<p>¿Cuánto se apostaría? ¿Qué porcentaje de su capital inicial se jugaría?</p>
<p>Suponga que decide apostar siempre un porcentaje fijo, $latex x$ del dinero del que disponga en cada momento. Tras la primera jugada, tendría $latex a + b a x = a(1+bx)$ de ganar y le quedarían $latex a (1-x)$ de perder. Puede seguir jugando y en cada partida su capital se multiplicaría por $latex 1+bx$ o por $latex 1-x$ según su suerte. Al cabo de $latex n$ partidas, de haber ganado $latex w$ de ellas, su capital inicial se habría multiplicado por</p>
<p>$$ (1+bx)^w (1-x)^{n-w}. $$</p>
<p>La pregunta es: ¿qué proporción $latex x$ de su capital maximizaría su beneficio? Tomando el logaritmo de la expresión anterior se puede definir la función</p>
<p>$$ f(x) = w \log(1+bx) + (n-w) \log (1-x) $$</p>
<p>de cuya derivada (qué tiempos) igualada a cero,</p>
<p>$$ f^\prime (x) = \frac{bw}{(1+bx)} - \frac{n-w}{1-x} = 0 $$</p>
<p>se puede despejar</p>
<p>$$ x = \frac{wb - (n - w)}{nb}, $$</p>
<p>que sería la proporción <em>óptima</em>. Nótese que uno querría fijar $latex x$ de antemano, pero éste sólo se conoce después de participar en el juego y contar el número de éxitos. No obstante,</p>
<p>$$x=\frac{wb-(n-w)}{nb}=\frac{bw/n-(1-w/n)}{b}$$</p>
<p>y el cociente $latex \frac{w}{n}$ tiende a $latex p$, la probabilidad de éxito, conforme crece $latex n$. En el límite, la proporción óptima sería pues</p>
<p>$$ x = \frac{bp-(1-p)}{b} $$,</p>
<p>valor conocido como <em><a href="http://en.wikipedia.org/wiki/Kelly_criterion">apuesta de Kelly</a></em>. El criterio de Kelly en contextos similares al que planteo en esta entrada sugiere realizar apuestas de tal cuantía. Y una búsqueda en Google del término parece indicar que es conocido de los aficionados a los juegos de azar y también —alguien tal vez aquí quiera hacer un comentario obvio— entre los profesionales de las finanzas —se dice que lo utiliza incluso Warren Buffet—y otros. Fue de hecho en un foro de <em>quants</em> que entré en conocimiento con este problema.</p>
<p>Tomando la esperanza de $latex f(x)$ —que consiste en reemplazar $latex w$ por $latex np$— y repitiendo el proceso indicado más arriba, puede probarse que la apuesta de Kelly maximiza la esperanza del logaritmo del resultado del juego para cada $latex n$. También, dado que la distribución subyacente es binomial, y dado que la mediana de dicha distribución es, redondeando, $latex np$, también se demuestra que la apuesta de Kelly maximiza la mediana de las ganancias (en cualquier escala, logarítmica o no). Pese a estas felices circunstancias, el uso de este criterio no está exento de <em>caveats</em>:</p>
<ul>
<li>Es raro que un <em>inversor</em> quiera maximizar la esperanza del logaritmo</li>
<li>De hecho, de acuerdo con el <a href="http://es.wikipedia.org/wiki/Capital_Asset_Pricing_Model">CAPM</a>, un inversor debe considerar dos parámetros simultáneamente: rentabilidad (típicamente, la media de las ganancias) y riesgo (o su varianza o alguna otra medida más robusta de la dispersión). Sin embargo, el criterio de Kelly no tiene en cuenta éste último.</li>
</ul>
<p>En efecto, en la deducción que hemos hecho más arriba de la apuesta óptima, hemos supuesto conocida la historia de resultados del juego (se ganaba $latex w$ de las $latex n$ veces), pero $latex w$ es una variable aleatoria con distribución binomial y no en todos los casos la proporción de éxitos va a ser $latex p$: típicamente, será mayor o menor. Pero de obtener $latex i$ éxitos por debajo de lo esperado, el resultado final sufre un recorte de $latex (1-x)^i$ que puede resultar muy sustancial si $latex x $ es cercano a 1.</p>
<p>El problema puede tratarse analíticamente y es fácil analizar completamente el beneficio que puede generar un juego al cabo de un número dado de iteraciones fijados $latex p$ y $latex b$. El siguiente gráfico muestra los deciles del beneficio tras 100 iteraciones de un juego con $latex p=0.8$ y $latex b=4$.</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2011/05/kelly_criterion_0.png"><img src="http://www.datanalytics.com/wp-uploads/2011/05/kelly_criterion_0.png" alt="Kelly criterion">
</a></p>
<p>Si por el contrario $latex p=0.8$ y $latex b=2,1$ se obtiene esta otra configuración de beneficios:</p>
<p><a href="http://www.datanalytics.com/wp-uploads/2011/05/kelly_criterion_1.png"><img src="http://www.datanalytics.com/wp-uploads/2011/05/kelly_criterion_1.png" alt="">
</a></p>
<p>En los dos gráficos anteriores se aprecia cómo los rangos <em>interdecílicos</em> se estrechan a la izquierda de la apuesta de Kelly y se ensanchan a su derecha. Un inversor cauto preferiría tal vez apostar por debajo del nivel propuesto por el criterio de Kelly para reducir la varianza del resultado de su apuesta. Esta precaución cobra más importancia en las situaciones en que no se conoce $latex p$ con precisión: si se sospecha que su <em>valor verdadero</em> está en un intervalo de cierto tamaño alrededor de un estimador $latex p^\prime$, un inversor cauto apostaría un porcentaje inferior a</p>
<p>$$ \frac{bp^\prime-(1-p^\prime)}{b} $$</p>
<p>para evitar que el valor anterior caiga, tal vez catastróficamente, a la derecha del óptimo</p>
<p>$$ \frac{bp-(1-p)}{b}.$$</p>
<p>Finalmente, y para que mis lectores puedan cacharrear, adjunto el código &mdash;un tanto vergonzante&mdash; con el que he creado los gráficos de esta entrada:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">    game.payoff <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(f, trials <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, quantile <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>){
    	wins  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">qbinom</span>(quantile, trials, p)
    	loses <span style="color:#f92672">&lt;-</span> trials <span style="color:#f92672">-</span> wins
    	wins <span style="color:#f92672">*</span> <span style="color:#a6e22e">log</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> b <span style="color:#f92672">*</span> f) <span style="color:#f92672">+</span> loses <span style="color:#f92672">*</span> <span style="color:#a6e22e">log</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> f)
    }

    my.quantiles <span style="color:#f92672">&lt;-</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>
    my.fraction <span style="color:#f92672">&lt;-</span>  (<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">99</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>

    tmp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sapply</span>(my.fraction, <span style="color:#a6e22e">function</span>(x)
          <span style="color:#a6e22e">sapply</span>(my.quantiles, <span style="color:#a6e22e">function</span>(q)
          <span style="color:#a6e22e">game.payoff</span>(x, quantile <span style="color:#f92672">=</span> q)))

    <span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">99</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">max</span>(tmp)), type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n&#34;</span>,
        main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Resultado según % de apuesta\n (p = 0.9, b = 0.6, Kelly = 70%)&#34;</span>,
        xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;%&#34;</span>, ylab<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;log del resultado&#34;</span>)
    <span style="color:#a6e22e">apply</span>(tmp, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">lines</span>(x, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;l&#34;</span>))

    <span style="color:#a6e22e">lines</span>(tmp[5,], type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;l&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>)
    <span style="color:#a6e22e">abline</span>(v <span style="color:#f92672">=</span> <span style="color:#ae81ff">70</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)</code></pre></td></tr></table>
</div>
</div>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/probabilidad/" rel="tag">probabilidad</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">r</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/2011/05/10/terrorismo-sesgos-percepcion-improbabilidad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Anterior</span>
			<p class="pager__title">Terrorismo y sesgos en la percepción de la improbabilidad</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/2011/05/13/consejos-para-utilizar-r-en-produccion/" rel="next">
			<span class="pager__subtitle">Siguiente&thinsp;»</span>
			<p class="pager__title">Consejos para utilizar R &#34;en producción&#34;</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Más Recientes</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-exceso-mortalidad-noviembre-2021/">Sobre el exceso de mortalidad en noviembre de 2021</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/09/mas-sobre-la-estimacion-de-probabilidades-de-eventos-que-no-se-repiten/">Más sobre la estimación de probabilidades de eventos que no se repiten</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/07/estadistica-vs-siquiatria-la-aparente-contradiccion-la-profunda-sintesis/">Estadística vs siquiatría: la aparente contradicción, la profunda síntesis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/12/02/por-que-cabe-argumentar-que-estos-resultados-infraestiman-la-efectividad-de-las-vacunas-contra-el-covid/">¿Por qué cabe argumentar que estos resultados infraestiman la efectividad de las vacunas contra el covid?</a></li>
			<li class="widget__item"><a class="widget__link" href="/2021/11/25/un-episodio-relevante-para-estas-paginas-extraido-de-un-espia-perfecto/">Un episodio relevante para estas páginas extraído de &#34;Un espía perfecto&#34;</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 datanalytics.
      
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"], ["$latex", "$"],["\\(","\\)"]]} })
</script>

</body>
</html>